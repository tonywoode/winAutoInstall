if(!window.MS)window.MS={};if(!MS.Support)MS.Support={};if(!MS.Support.MSS)MS.Support.MSS={};if(typeof Answers==="undefined")Answers={};MS.Support.MSS.Utils={AddEvent:function(el,strEvent,funcPtr){if(window.addEventListener)el.addEventListener(strEvent,funcPtr,false);else if(window.attachEvent)el.attachEvent("on"+strEvent,funcPtr)},RemoveEvent:function(el,strEvent,funcPtr){if(window.removeEventListener)el.removeEventListener(strEvent,funcPtr,false);else if(window.detachEvent)el.detachEvent("on"+strEvent,funcPtr)},SrcEl:function(e){if(e.srcElement)return e.srcElement;if(e.target)return e.target;return e},setCookie:function(key,val,subkey,persist){if(!key)return;var cv,cs="";if(persist){var d=new Date;cs+="; expires="+d.toGMTString(d.setFullYear(d.getFullYear()+1))}var ld=document.domain;if(typeof gCookieDomain!="undefined"&&gCookieDomain!=null&&gCookieDomain!="")ld=gCookieDomain;if(ld.indexOf(".com")>-1)cs+="; Domain="+ld;cv=this.getCookie(key);if(cv&&subkey){var cn,subkeyfound=false;if(cv.indexOf("=")>-1){var ca=cv.split("&");for(var i=0;i<ca.length;i++){cn=ca[i].substring(0,ca[i].indexOf("="));if(cn.charAt(0)==" ")cn=cn.substring(1,cn.length);if(subkey===cn){ca[i]=subkey+"="+val;cv=ca.join("&");subkeyfound=true;break}}if(!subkeyfound){if(ca.length>0)cv+="&";cv+=subkey+"="+val}}else cv=subkey+"="+val}else if(!cv&&subkey)cv=subkey+"="+val;else if(!subkey)cv=val;else return;document.cookie=key+"="+cv+cs+"; path=/"},getCookie:function(key,subkey){if(!key)return;var cn,cv,ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){cn=ca[i].substring(0,ca[i].indexOf("="));if(cn.charAt(0)==" ")cn=cn.substring(1,cn.length);if(key===cn){cv=ca[i].substring(ca[i].indexOf("=")+1,ca[i].length);break}}if(!cv)return "";if(!subkey)return cv;ca=cv.split("&");for(i=0;i<ca.length;i++){cn=ca[i].substring(0,ca[i].indexOf("="));if(cn.charAt(0)==" ")cn=cn.substring(1,cn.length);if(subkey===cn)return ca[i].substring(ca[i].indexOf("=")+1,ca[i].length)}}};var initialized=initialized?initialized:false;MS.Support.MSS.Logging=function(){var mssUtils=MS.Support.MSS.Utils,imgLoaded=false,startDate="";encodeURL=function(strInput){if(typeof strInput=="undefined")return "";strInput=strInput.toString();var c,EncodeUrl="";for(var cnt=0;cnt<strInput.length;cnt++){c=strInput.charCodeAt(cnt);if(c>96&&c<123||c>64&&c<91||c>47&&c<58||c==46||c==45||c==95)EncodeUrl=EncodeUrl+String.fromCharCode(c);else if(c>127)EncodeUrl=EncodeUrl+"%u"+encodeTwoByteHex(c);else EncodeUrl=EncodeUrl+"%"+encodeSingleByteHex(c)}return EncodeUrl};encodeSingleByteHex=function(charC){var SingleByteHex=charC.toString(16);for(var cnt=SingleByteHex.length;cnt<2;cnt++)SingleByteHex="0"+SingleByteHex;return SingleByteHex};encodeTwoByteHex=function(charC){var TwoByteHex=charC.toString(16);for(var cnt=TwoByteHex.length;cnt<4;cnt++)TwoByteHex="0"+TwoByteHex;return TwoByteHex};getCookieIncrement=function(){var cookieKey="sdninc",inc=mssUtils.getCookie(cookieKey);if(inc=="")inc="0";inc=parseInt(inc);inc+=1;document.cookie=cookieKey+"="+inc+"; path=/;";return inc};setLogCollectionBit=function(collection,bit){if(bit<0||bit>59)return;collection|=1<<bit;return collection};logPageOnLoad=function(){this.HookLoadEvents();DataCollectionObj.options.eventSeqNo=getCookieIncrement();if(!DataCollectionObj.options.delayOnLoad)window.ltsDataReady=true;window.ltsDelayLoadRetry=0;sendLog()};sendLog=function(){if(!window.ltsDataReady&&window.ltsDelayLoadRetry<300){window.ltsDelayLoadRetry++;setTimeout(sendLog,300);return}GetExtraLoggingValues();var currentOpts=DataCollectionObj.options,elem=document.createElement("img");elem.id=currentOpts.dataCollectionImg;elem.name=currentOpts.dataCollectionImg;elem.onerror=function(){this.style.display="none"};document.body.appendChild(elem);var ltsUrl=window.location.protocol+"//"+currentOpts.host+"?";ltsUrl+="SSID="+Answers.Res.LtsLogging.Ssid+"&"+"EventCollectionID="+currentOpts.eventCollectionId+"&"+"URL="+encodeURL(currentOpts.url)+"&"+"SiteCulture="+encodeURL(currentOpts.siteLn)+"&"+"RefURL="+encodeURL(currentOpts.refUrl)+"&"+"EventSeqNo="+encodeURL(currentOpts.eventSeqNo)+"&"+"SSversion="+encodeURL(currentOpts.ssVersion)+"&"+"BrandId="+encodeURI(currentOpts.brandId)+"&"+"FlexValue1="+encodeURI(currentOpts.flexValue1)+"&"+"FlexValue2="+encodeURI(currentOpts.flexValue2)+"&"+"FlexValue3="+encodeURI(currentOpts.flexValue3)+"&"+"FlexValue4="+encodeURI(currentOpts.flexValue4)+"&"+"FlexValue5="+encodeURI(currentOpts.flexValue5)+"&"+"FlexValue8="+encodeURI(currentOpts.flexValue8)+"&"+"FlexValue9="+encodeURI(currentOpts.flexValue9)+"&"+"FlexValue10="+encodeURI(currentOpts.flexValue10)+"&"+"FlexId="+encodeURI(currentOpts.flexId);mssUtils.AddEvent(elem,"load",function(){MS.Support.MSS.Logging.imgLoaded=true});elem.src=ltsUrl};logPageOnUnLoad=function(){var dataCollImg=document.getElementById(DataCollectionObj.options.dataCollectionImg);if(!dataCollImg)return;if(!MS.Support.MSS.Logging.imgLoaded)return;var endDate=new Date,currentOpts=DataCollectionObj.options;currentOpts.dwellTime=endDate.getTime()-currentOpts.startDate.getTime();if(currentOpts.scrollUsed)currentOpts.eventCollectionId=setLogCollectionBit(currentOpts.eventCollectionId,27);if(currentOpts.eventSeqNo=="0")currentOpts.eventSeqNo=getCookieIncrement();AddActiveTime(endDate,true);currentOpts.suppressBlur=true;var ltsUrl=window.location.protocol+"//"+currentOpts.host+"?";ltsUrl+="SSID="+Answers.Res.LtsLogging.Ssid+"&"+"EventCollectionID="+currentOpts.eventCollectionId+"&"+"SiteCulture="+encodeURL(currentOpts.siteLn)+"&"+"SSversion="+encodeURL(currentOpts.ssVersion)+"&"+"DwellTime="+encodeURL(currentOpts.dwellTime)+"&"+"TargetURL="+encodeURL(currentOpts.targetUrl)+"&"+"EventSeqNo="+encodeURL(currentOpts.eventSeqNo)+"&"+"unload=true"+"&"+"ActiveDwellTime="+encodeURL(currentOpts.activeDwellTime)+"&"+"BrandId="+encodeURI(currentOpts.brandId)+"&"+"FlexValue1="+encodeURI(currentOpts.flexValue1)+"&"+"FlexValue2="+encodeURI(currentOpts.flexValue2)+"&"+"FlexValue3="+encodeURI(currentOpts.flexValue3)+"&"+"FlexValue4="+encodeURI(currentOpts.flexValue4)+"&"+"FlexValue5="+encodeURI(currentOpts.flexValue5)+"&"+"FlexValue6="+encodeURL(currentOpts.exitContainerId)+"&"+"FlexValue7="+encodeURL(currentOpts.exitLinkId)+"&"+"FlexValue8="+encodeURI(currentOpts.flexValue8)+"&"+"FlexId="+encodeURI(currentOpts.flexId);dataCollImg.src=ltsUrl;var today=new Date,now=today.getTime();while(1){var today2=new Date,now2=today2.getTime();if(now2-now>currentOpts.onUnloadTimeout)return}};setExitLinks=function(e){var El=$(mssUtils.SrcEl(e)),anotherel=$(mssUtils.SrcEl(e));if(El.is("input")){if(!El.is("[type=submit]"))El=El.closest("form").find("input[type=submit]");if(El.attr("linkId")==undefined)return;DataCollectionObj.options.exitLinkId=El.attr("linkId");DataCollectionObj.options.exitContainerId=El.closest("[containerId]").attr("containerId");return}var filterSections=$("#filterBar .subNavbarSection");if(filterSections.length){var filterindex=filterSections.index(El.parents(".subNavbarSection"));if(filterindex==1)DataCollectionObj.options.flexValue2=$.trim(El.text());else if(filterindex==2)DataCollectionObj.options.flexValue3=$.trim(El.text())}if(!El.is("a"))El=El.closest("a");if(El.attr("href")==undefined)return;if(El.attr("href").indexOf("javascript:")>-1)return;if(El.attr("href").indexOf("mailto:")>-1)return;if(El.attr("linkId")!=undefined){DataCollectionObj.options.exitLinkId=El.attr("linkId");DataCollectionObj.options.exitContainerId=El.closest("[containerId]").attr("containerId")}DataCollectionObj.options.targetUrl=El.attr("href")};SetEnterExitLinks=function(e){if(e.keyCode==13)SetExitLinks(e)};GetExtraLoggingValues=function(){var extraLogDiv=$("div[pagetype]"),forumIdVal=extraLogDiv.attr("forumId");if(forumIdVal==undefined)forumIdVal=$("#varForumId").val();DataCollectionObj.options.flexValue2=window.ltsFlexValue2?window.ltsFlexValue2:"";DataCollectionObj.options.flexValue3=window.ltsFlexValue3?window.ltsFlexValue3:"";DataCollectionObj.options.flexValue4=forumIdVal!=undefined?forumIdVal:"";var threadIdVal=$("#varThreadId").val();DataCollectionObj.options.flexValue5=threadIdVal!=undefined?threadIdVal:"";DataCollectionObj.options.flexValue8=extraLogDiv.attr("pagetype")!=undefined?extraLogDiv.attr("pagetype"):"";var searchTerm=$("#varSearchTerm").val();DataCollectionObj.options.flexValue9=searchTerm!=undefined?searchTerm:"";var userIdViewed=$("div[userId]").attr("userId");DataCollectionObj.options.flexValue10=userIdViewed!=undefined?userIdViewed:""};scrollHandler=function(){DataCollectionObj.options.scrollUsed=true;mssUtils.RemoveEvent(window,"scroll",scrollHandler)};loggingOptions=function(logObject){this.startDate=siteStartDate;this.dataCollectionImg="dataCollectionImg";this.host=logObject.host;this.scrollUsed=false;this.eventCollectionId=1;this.url=document.location&&document.location!=""?document.location.toString():"";this.refUrl=document.referrer&&document.referrer!=""?document.referrer.toString():"";this.eventSeqNo=0;this.targetUrl="";this.ssVersion=logObject.ssVersion;this.siteLn=logObject.siteLn;this.onUnloadTimeout=150;this.delayOnLoad=logObject.delayOnLoad=="True";this.suppressBlur=false;this.activeDwellTime=0;this.activeStartTime=this.startDate;this.activeElement=null;this.timeoutID=-1;this.isIE=false;this.logExternalUrls=false;this.ltsIdleTimeout=logObject.ltsIdleTimeout;this.exitContainerId="";this.exitLinkId="";this.brandId=logObject.brandId;this.flexValue1=logObject.flexValue1;this.flexValue2="";this.flexValue3="";this.flexValue4="";this.flexValue5="";this.flexValue8="";this.flexValue9="";this.flexValue10="";this.flexId=logObject.flexId};AddActiveTime=function(now){if(DataCollectionObj.options.activeStartTime==null||arguments.length==1&&DataCollectionObj.options.activeElement!=document.activeElement&&DataCollectionObj.options.isIE){DataCollectionObj.options.activeElement=document.activeElement;return}if(DataCollectionObj.options.suppressBlur)return;DataCollectionObj.options.activeDwellTime+=now.getTime()-DataCollectionObj.options.activeStartTime.getTime();DataCollectionObj.options.activeStartTime=null};CheckActivity=function(){if(DataCollectionObj.options.activeStartTime!=null)AddActiveTime(new Date)};ResetDwellTime=function(){if(DataCollectionObj.options.timeoutID!=-1)clearTimeout(DataCollectionObj.options.timeoutID);DataCollectionObj.options.timeoutID=setTimeout(CheckActivity,DataCollectionObj.options.ltsIdleTimeout);if(DataCollectionObj.options.activeStartTime==null)DataCollectionObj.options.activeStartTime=new Date};FocusHandler=function(){ResetDwellTime();if(DataCollectionObj.options.activeStartTime==null&&(document.activeElement!=null&&DataCollectionObj.options.activeElement==document.activeElement||!DataCollectionObj.options.isIE))DataCollectionObj.options.activeStartTime=new Date};HookLoadEvents=function(){DataCollectionObj.options.isIE=navigator.appName=="Microsoft Internet Explorer";DataCollectionObj.options.activeElement=document.activeElement;if(DataCollectionObj.options.isIE){document.onfocusin=FocusHandler;document.onfocusout=function(event){AddActiveTime(new Date)}}else{$(window).focus(FocusHandler);$(window).blur(function(event){AddActiveTime(new Date)})}DataCollectionObj.options.timeoutID=setTimeout(CheckActivity,DataCollectionObj.options.ltsIdleTimeout);$(document.body).click(ResetDwellTime);$(document.body).keypress(ResetDwellTime);$(window).scroll(ResetDwellTime)};this.options=null;this.Initialize=function(logParams){if(initialized==true)return;initialized=true;this.options=new loggingOptions(logParams);mssUtils.AddEvent(document,"click",function(e){try{setExitLinks(e)}catch(err){}});mssUtils.AddEvent(document,"keydown",function(e){try{SetEnterExitLinks(e)}catch(err){}});mssUtils.AddEvent(window,"load",function(){try{logPageOnLoad()}catch(err){}});mssUtils.AddEvent(window,"unload",function(){try{logPageOnUnLoad()}catch(err){}});mssUtils.AddEvent(window,"scroll",scrollHandler)}};var DataCollectionObj=DataCollectionObj?DataCollectionObj:new MS.Support.MSS.Logging;$(document).ready(function(){if(typeof DataCollectionObjParams!="undefined")DataCollectionObj.Initialize(DataCollectionObjParams)})