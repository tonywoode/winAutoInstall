if(typeof Answers==="undefined")var Answers={};Answers.Thread={ThreadType:"",SetEditPanel:function(threadEditType,msgId,titleText){if(msgId)$("#EditMessageId").val(msgId);$("#EditReasonPanel").remove();var reasonPanel=$(".editReasonPanel").clone().prop({id:"EditReasonPanel"});reasonPanel.find(".editReason").prop({id:"EditReason",name:"EditReason"});reasonPanel.find(".unselecteEditReasonError").prop({id:"unselecteEditReasonError"});$("#abuseEditAckGrp").hide();$("#editTitleDesc, #editDetailsDesc, #DeleteBtn").show();$("#EditThreadFormTitle").text(titleText?titleText:Answers.Res.ViewThread.EditHover);var placeholder=Answers.Thread.SetEditReason(threadEditType,msgId);$("#markAbuseType").val("");$("#EditReason").val("");$("#subscribeOnReplyInput").prop("checked",$("#subscribeOnReplyInput").data("subscribe"));$("#NotifyMe").prop("checked",$("#NotifyMe").data("subscribe"));if(placeholder==null){reasonPanel.hide().appendTo($(document.body));return}if(reasonPanel.parent().attr("id")!=placeholder.attr("id"))reasonPanel.appendTo(placeholder);$("#unselecteEditReasonError").hide();reasonPanel.show()},SetEditReason:function(threadEditType,msgId){return null},Edit:function(threadEditType,msgId,titleText,selector){if($("#postform").is(":visible")){alert(Answers.Res.ViewThread.OneEditor);return}Answers.Util.CallScript(!window.askmd,Answers.Res.MetaDataScript,function(){Answers.Util.CallScript(!window.rte&&!window.kendo,Answers.Res.ReplyEditorScript,function(){var messageContent=null,form=$("#editPostDiv");if(form.length>0){$("#ThreadEditType").val(threadEditType);$("#Thread_Title").val($("#threadTitle").text().replace(/^\s+|\s+$/g,""));if($("#Thread_LocaleName").val()!==undefined&&$("#Thread_LocaleName").val()!==$("#varLocaleName").val()){$("#Thread_LocaleName").val($("#varLocaleName").val());$("#Thread_LocaleName").change()}else if($("#Thread_ForumId").val()!==$("#varForumId").val()){$("#Thread_ForumId").val($("#varForumId").val());$("#Thread_ForumId").change()}if(askmd)askmd.onForumSelectChange($("#varForumId").val(),$("#ThreadMetaDatasInit").val(),false);Answers.Thread.SetEditPanel(threadEditType,msgId,titleText);Answers.Util.ShowDialog(form,{focusBack:selector});Answers.Editor.Create("Thread_MessageText");Answers.Editor.Bind("Thread_MessageText","focus",function(){$("#ThreadMessageErrMsg").hide()});$(".editorLoading").hide();if(threadEditType==="SplitThread"){var msg=Answers.Res.SplitThreadMsg.replace("threadUrl",document.location.href.split("?")[0]);messageContent='<blockquote class="replyQuote">'+msg+"</blockquote><p></p>"}else messageContent="";messageContent=messageContent+(msgId==null?$("div.msgBody:first").html():$('div[msgId="'+msgId+'"]').first().find(".msgBody").html());Answers.Editor.Content("Thread_MessageText",messageContent);return}var forumId=$("#varForumId").val();$.get(Answers.Res.EditThreadUrl,{threadId:$("#varThreadId").val(),editType:threadEditType},function(content){var $content=$(content);$content.hide().appendTo("#Footer");Answers.Thread.SetEditPanel(threadEditType,msgId,titleText);var metadata=$("#ThreadMetaDatasInit").val();$("#editPostDiv").addClass("dialogPanel");Answers.Util.ShowDialog($("#editPostDiv"),{focusBack:selector});Answers.Editor.Create("Thread_MessageText");Answers.Editor.Bind("Thread_MessageText","focus",function(){$("#ThreadMessageErrMsg").hide()});$(".editorLoading").hide();if(threadEditType==="SplitThread"){var msg=Answers.Res.SplitThreadMsg.replace("threadUrl",document.location.href.split("?")[0]);messageContent='<blockquote class="replyQuote">'+msg+"</blockquote><p></p>"}else messageContent="";messageContent=messageContent+(msgId==null?$("div.msgBody:first").html():$('div[msgId="'+msgId+'"]').first().find(".msgBody").html());Answers.Editor.Content("Thread_MessageText",messageContent);$("#Thread_Title").focus();if(askmd){askmd.setEventHandler($("#editPostDiv"));askmd.onForumSelectChange(forumId,metadata,threadEditType=="MoveThread")}},"html")})})},Delete:function(){$.post(Answers.Res.DeleteThreadUrl,{threadId:$("#varThreadId").val(),deleteThread:true,antiForgeryKey:$("#_AntiForgeryKey").val()},function(response){if(response.Success){Answers.NewThread.suspendLeavePageWarning=true;Answers.Util.ReloadPage("/")}else $("#postError").text(Answers.Res.ViewThread.PostError).show()},"json")},Join:function(threadId){Answers.Auth.SignInThen("Join",threadId)},JoinAfterSignIn:function(threadId){var joinFn=function(emailIsValid){if(emailIsValid)$.post(Answers.Res.JoinUrl,{threadId:threadId,join:true,antiForgeryKey:$("#_AntiForgeryKey").val()},function(response){if(response.Success){if(typeof Answers.SharedContext!="undefined"&&Answers.SharedContext.Initialized)Answers.SharedContext.Log("JoinedThreads",threadId);Answers.Util.SetEventLogging(3);Answers.Thread.RefreshMsgContent($("#questioncontainer").attr("msgid"))}},"json");else $(".thdJoinBtn").removeClass("disabled")};$(".thdJoinBtn").addClass("disabled");Answers.Auth.VerifyEmail(joinFn)},Recommend:function(threadId){Answers.Auth.SignInThen("Recommend",threadId)},RecommendAfterSignIn:function(threadId){var recommendFn=function(emailIsValid){if(emailIsValid)$.post(Answers.Res.RecommendUrl,{threadId:threadId,recommend:true,antiForgeryKey:$("#_AntiForgeryKey").val()},function(response){if(response.Success){if(typeof Answers.SharedContext!="undefined"&&Answers.SharedContext.Initialized)Answers.SharedContext.Log("RecommendedThreads",threadId);Answers.Util.SetEventLogging(3);Answers.Thread.RefreshMsgContent($("#questioncontainer").attr("msgid"))}},"json");else $(".thdRecommendBtn").removeClass("disabled")};$(".thdRecommendBtn").addClass("disabled");Answers.Auth.VerifyEmail(recommendFn)},Reply:function(msgId,quote){Answers.Auth.SignInThen("Reply",msgId,quote)},ReplyAfterSignIn:function(msgId,quote){quote=quote===true||quote==="true";var actType=quote?"1":"2",msgDiv=$('div[msgId="'+msgId+'"]').first(),jReplyBtn=msgDiv.find(".msgReplyBtn").first();if(jReplyBtn.closest("div[msgId].privateReply").length>0)actType="5";var container=jReplyBtn.closest(".message");if($("#postform").is(":visible")){if(container.find("#postform").length<=0)alert(Answers.Res.ViewThread.OneEditor);return false}Answers.Util.CallScript(!window.rte&&!window.kendo,Answers.Res.ReplyEditorScript,function(){$.ajax({type:"GET",dataType:"html",url:Answers.Res.ViewThread.MessageReplyBox,cache:false,data:{messageId:msgId,isPublic:actType!="5",page:parseInt($("#currentPage").val(),10)||1},success:function(response){var hideReplyValidationErrorMessage=function(){$("#replyError").hide()};$(".postReply").remove();container.append(response);$("#actMsgId").val(msgId);$("#actType").val(actType);container.find(".msgReplyBtn, .msgReplyQtBtn, .msgEditBtn, .thdEditBtn").addClass("disabled");var replybox=$(".postReply",container);Answers.Thread.SetEditPanel("");$("#subscribeOnReplyGrp",replybox).show();$(".postReplyTitle",replybox).text(jReplyBtn.text());$("#replyDeleteBtn",replybox).hide();$(".replyUploadBtn",replybox).on("click.threadactions",function(event){var url=Answers.Res.UploadFileUrl+"?uploadFileSessionId="+$("#uploadFileSessionId").val(),that=$(this);if(that.hasClass("disabled"))return;that.addClass("disabled");$("#fuderror").text("");$.get(url,{},function(data){$("#uploadFileFrame").attr("src",url).removeClass("hidden").show()})});var warningDisplayed=Answers.Thread.ShowHidePrivateReplyOptions(jReplyBtn);replybox.show();var textinreply="";if(quote){var msgElem=$("div[msgId='"+msgId+"']:first .fullMessage");textinreply='<blockquote class="replyQuote">'+msgElem.html()+"</blockquote><p></p>"}Answers.Editor.Create("replyEditor",textinreply);if(!warningDisplayed)Answers.Editor.Focus("replyEditor");Answers.Editor.Bind("replyEditor","focus",hideReplyValidationErrorMessage);$(".editorLoading").hide()}})});return true},ShowHidePrivateReplyOptions:function(item){var button=$(item),msgContainer=button.closest("div[msgId]");if($("#privateMessages").length===0)return false;if(!msgContainer.hasClass("privateReply")&&Answers.Util.GetCookie("dontWarnOnPublicReplyWithPrivate")!="true"){button.addClass("wasClicked");Answers.Util.ShowDialog($("#replyToMessageWithPrivateWarning"),{focusBack:button.get(0)});$("#privateWarningCancel").click(function(){Answers.Thread.HideReply()});return true}if(button.closest(".privateConversation").hasClass("addnewprivatemessage")){$("#allowprivatereplies, #privatereplytext, #allowfileupload, #fileuploadtext").show();$("#fileUploadDiv").hide()}else{$("#allowprivatereplies, #privatereplytext, #allowfileupload, #fileuploadtext").hide();$("#fileUploadDiv").toggle(button.parents(".privateConversation").find(".privateControls").hasClass("fileUpload"))}return false},EditReply:function(jEditBtn,msgId,replyType){var container=jEditBtn.closest(".message");if($("#postform").is(":visible")){if(container.find("#postform").length<=0)alert(Answers.Res.ViewThread.OneEditor);return}Answers.Util.CallScript(!window.rte&&!window.kendo,Answers.Res.ReplyEditorScript,function(){$.ajax({type:"GET",dataType:"html",url:Answers.Res.ViewThread.MessageReplyBox,cache:false,data:{messageId:msgId,isPublic:replyType!="5",page:parseInt($("#currentPage").val(),10)||1},success:function(response){$(".postReply").remove();container.append(response);$(".postReply").show();Answers.Thread.SetEditPanel(replyType=="4"?"EditReplyByModerator":"");$("#actMsgId").val(msgId);$("#actType").val(replyType);container.find("div.msgContent").hide();$("#postform .postReplyTitle").text(jEditBtn.text());if(replyType!="4"){var isAnswer=$('div[msgId="'+msgId+'"]').hasClass("answerTagged");$("#replyDeleteBtn").toggleClass("disabled",isAnswer).attr("title",isAnswer?Answers.Res.ViewThread.DelPostAnswer:Answers.Res.ViewThread.DelPostHover).show()}var msgElem=$('div[msgId="'+msgId+'"]:first .msgBody'),htmlToEdit=msgElem.html();$("#HiddenTextForHtmlCleanup").html(htmlToEdit);$("#HiddenTextForHtmlCleanup .AnswersExternalContent").remove();htmlToEdit=$("#HiddenTextForHtmlCleanup").html();Answers.Editor.Create("replyEditor",htmlToEdit,true);Answers.Editor.Bind("replyEditor","focus",function(){$("#replyError").hide()});$(".editorLoading").hide()}})})},HideReply:function(){Answers.Editor.Remove("replyEditor");$("#replyError").text("").hide();$("#subscribeOnReplyGrp").hide();var replyForm=$("#postform");replyForm.hide();var container=replyForm.closest("div[msgId]"),actType=$("#actType").val();if(actType!=="7")container.find(".msgReplyBtn, .msgReplyQtBtn, .msgEditBtn, .thdEditBtn").removeClass("disabled");$(".editReasonPanel").hide();container.find("div.msgContent").show();$("#fileuploaded").html("");$("#fuderror").text("");$("#uploadFileFrame").addClass("hidden");$(".replyUploadBtn").removeClass("disabled");$("#uploadFileSessionId").val("");if(Answers.Util.QueryString("tab")&&Answers.Util.QueryString("tab").toLowerCase()==="privatemessage")if($(".privateReply").length===0){Answers.Thread.SuspendOnUnloadMsg=true;window.location.href=window.location.href.replace(/tab=privatemessage/i,"tab=allreplies");return}else replyForm.closest(".privatereplies").find(".msgReplyBtn, .msgReplyQtBtn").removeClass("disabled");replyForm.parent().focus();replyForm.remove()},PostReply:function(){var msgText=Answers.Editor.Text("replyEditor"),msgHtml=Answers.Editor.Content("replyEditor");if(msgText.length<Answers.Res.ViewThread.ReplyMinChars||msgHtml.length<Answers.Res.ViewThread.ReplyMinChars){$("#replyError").text(Answers.Res.ViewThread.ReplyMinMsg).show();return}else if(msgText.length>Answers.Res.ViewThread.ReplyMaxChars||msgHtml.length>Answers.Res.ViewThread.ReplyMaxChars){var errMsg=Answers.Res.ViewThread.ReplyMaxMsg.replace("{0}",Math.max(msgText.length,msgHtml.length));$("#replyError").text(errMsg).show();return}var fileUploadId=null,requireCheckEmailForReply=false,url=null,actType=$("#actType").val();if(actType=="1"||actType=="2"){url=Answers.Res.ReplyUrl;requireCheckEmailForReply=true}else if(actType=="3"||actType=="4"){if(actType=="4"&&$("#EditReason").val().length<1){$("#unselecteEditReasonError").text(Answers.Res.ViewThread.UnselecteEditReasonError).show();return}url=Answers.Res.EditReplyUrl}else if(actType=="5"){url=Answers.Res.NewPrivateMessageUrl;requireCheckEmailForReply=true;if($("#fileuploaded .fileitem").length>0)fileUploadId=$("#uploadFileSessionId").val()}else if(actType=="6")url=Answers.Res.MessageAbuseMarkUrl;else if(actType=="7")url=Answers.Res.MessageAbuseUnmarkUrl;if(url==null)return;var subscribe=$("#subscribeOnReplyInput").is(":checked");$("#replySubmitBtn, #replyCancelBtn, #replyDeleteBtn").addClass("disabled");var submitFunc=function(success){var tId=$("#varThreadId").val(),mId=$("#actMsgId").val();if(!success){$("#replySubmitBtn, #replyCancelBtn, #replyDeleteBtn").removeClass("disabled");return}$.post(url,{threadId:tId,messageId:mId,reason:$("#EditReason").val(),message:msgHtml,enableRecepientReply:$("#allowprivatereplies").is(":checked"),enableFileUpload:$("#allowfileupload").is(":checked"),fileUploadId:fileUploadId,abuseTypeId:$("#markAbuseType").val(),subscribe:subscribe,antiForgeryKey:$("#_AntiForgeryKey").val()},function(response){$("#replySubmitBtn, #replyCancelBtn, #replyDeleteBtn").removeClass("disabled");if(response.Success){var pmTab=$("#privateMessages").length>0;if(actType=="1"||actType=="2"){if(typeof Answers.SharedContext!="undefined"&&Answers.SharedContext.Initialized)Answers.SharedContext.Log("CreatedReplies",response.Result.msgid);Answers.Thread.SuspendOnUnloadMsg=true;var curpage=parseInt($("#currentPage").val(),10)||1;if(curpage>=response.Result.replypagenumber&&!pmTab){$.get(Answers.Res.MsgPanelUrl,{messageId:response.Result.msgid,tm:(new Date).getTime()},function(messagecontainer){var callback=function(){Answers.Thread.SetEventHandler($('div[msgId="'+response.Result.msgid+'"]'));Answers.DropNav.StartNav($('div[msgId="'+response.Result.msgid+'"]'));Answers.ProfileImage.RefreshProfileImage()};$("html,body").animate({scrollTop:$("#Footer").offset().top},"slow");$(messagecontainer).hide().appendTo("#allReplies").fadeIn(1000,callback)});$.get(Answers.Res.ViewThread.TabStripUrl,{threadId:tId,page:curpage,tm:(new Date).getTime()},function(tabstrip){$(".tabs").replaceWith(tabstrip)});if(response.Result.reloadQuestion)Answers.Thread.RefreshMsgContent($("#questioncontainer").attr("msgid"))}else Answers.Util.ReloadPage(response.Result.lastpage+"#LastReply")}else if(actType=="3"||actType=="4")Answers.Thread.RefreshMsgContent(mId);else if(actType=="5"){$(".postReply").remove();Answers.Util.ReloadPage(window.location.href.split("#")[0]+"#"+mId)}else if(actType=="6"||actType=="7")Answers.Thread.RefreshMsgContent(mId,actType=="7");$("#subscribeOnReplyGrp").hide();Answers.Thread.HideReply()}else{var message;if(response.IsError)message=response.ErrorMessage?response.ErrorMessage:Answers.Res.ViewThread.PostError;else message=response.Result?response.Result:Answers.Res.ViewThread.PostError;$("#replyError").text(message).show()}},"json")};if(requireCheckEmailForReply&&subscribe)Answers.Auth.VerifyEmail(submitFunc);else submitFunc(true)},DeleteReply:function(msgId){$("#replySubmitBtn, #replyCancelBtn, #replyDeleteBtn").addClass("disabled");var abuseTypeId=null;if($("#markAbuseType").val()!="")abuseTypeId=$("#markAbuseType").val();$.post(Answers.Res.DeleteMessageUrl,{messageId:msgId,abuseTypeId:abuseTypeId,antiForgeryKey:$("#_AntiForgeryKey").val()},function(response){$("#replySubmitBtn, #replyCancelBtn, #replyDeleteBtn").removeClass("disabled");if(response.Success){Answers.Thread.HideReply();var postform=$("#postform");if(postform.length)postform.appendTo("#PageContent");if(response.Result.refresh)Answers.Thread.RefreshMsgContent(response.Result.messageId,true);else{$('div[msgId="'+response.Result.messageId+'"]').hide();if(!$("div[msgId]").is(":visible"))Answers.Util.ReloadPage();else if(response.Result.nextMessage)$.get(Answers.Res.MsgPanelUrl,{messageId:response.Result.nextMessage,tm:(new Date).getTime()},function(messagecontainer){var callback=function(){Answers.Thread.SetEventHandler($('div[msgId="'+response.Result.nextMessage+'"]'));var pager=response.Result.pager;if(pager){pager=pager.replace("{0}",$("#goToPageNum").clone().wrap("<div>").parent().html());$("#goToPageText").html(pager)}if(response.Result.isLastPage===true)$("#nextPage").replaceWith('<span id="nextPage">'+$("#nextPage").html()+"</span>")};$(messagecontainer).hide().appendTo("#allReplies").fadeIn(1000,callback)})}var curpage=parseInt($("#currentPage").val(),10)||1;$.get(Answers.Res.ViewThread.TabStripUrl,{threadId:$("#varThreadId").val(),page:curpage,tm:(new Date).getTime()},function(tabstrip){$(".tabs").replaceWith(tabstrip)})}else $("#replyError").text(Answers.Res.ViewThread.PostError).show()},"json")},ShowReplyTo:function(message,parentMsgId,msgContainer){$.get(Answers.Res.MsgTextUrl,{messageId:parentMsgId,replymessage:message},function(result){msgContainer.html(result).show()})},Vote:function(msgId){Answers.Auth.SignInThen("Vote",msgId)},VoteAfterSignIn:function(msgId){$.post(Answers.Res.VoteUrl,{messageId:msgId,antiForgeryKey:$("#_AntiForgeryKey").val()},function(response){if(response.Success){if(typeof Answers.SharedContext!="undefined"&&Answers.SharedContext.Initialized)Answers.SharedContext.Log("VotedHelpful",msgId);var msgDiv=$("div[msgId='"+msgId+"']");if(!Answers.Util.IsElementInView(msgDiv[0]))msgDiv[0].scrollIntoView();var voteCount=msgDiv.find(".ratingCount"),newCount=Answers.Util.Increment(voteCount.show(),1);msgDiv.find(".voteText").text(window["Answers"]["Res"]["ViewThread"][Answers.Thread.ThreadType]["Voted"]);msgDiv.find(".ratingYBtn").addClass("active").attr("title",window["Answers"]["Res"]["ViewThread"][Answers.Thread.ThreadType]["VoteHoverVoted"])}},"json")},MarkAnswer:function(msgId,isAnswer){$.ajax({url:Answers.Res.MarkAnsUrl,type:"POST",dataType:"json",async:false,data:{messageId:msgId,answer:isAnswer,antiForgeryKey:$("#_AntiForgeryKey").val()},beforeSend:function(jqXHR,settings){settings.async=false},success:function(response){if(response.Success){var curpage=parseInt($("#currentPage").val(),10)||1;if(curpage===1)Answers.Thread.RefreshMsgContent($("#questioncontainer").attr("msgid"),false,function(){Answers.Thread.RefreshMsgContent(msgId,false,function(){var message=$("#allReplies").children().first();if(message.attr("msgId")===msgId)isAnswer?message.hide():message.show()})});else Answers.Thread.RefreshMsgContent(msgId)}}})},RefreshAllMessages:function(repliesonly){var msgId,selector,uniquemessages=[];if($("#privateMessages").length>0){msgId=$("#actMsgId");Answers.Util.ReloadPage(window.location.href.split("#")[0]+(msgId.length>0?"#"+msgId.val():""));return}selector=repliesonly===true?"#allReplies div[msgId], .unrenderedmessage[msgId]":"div[msgId], .unrenderedmessage[msgId]";$.each($(selector),function(i,val){msgId=$(val).attr("msgId");if($.inArray(msgId,uniquemessages)===-1){uniquemessages.push(msgId);Answers.Thread.RefreshMsgContent(msgId,false)}})},RefreshMsgContent:function(msgId,refreshall,callback){var actType=$("#actType").val(),selector='div[msgId="'+msgId+'"]',container=$(selector),parentId,dorefreshall,ajaxoptions={type:"GET",dataType:"html",url:Answers.Res.MsgPanelUrl,data:{messageId:msgId,tm:(new Date).getTime()},success:null,complete:null,statusCode:null};if(actType==="5"||container.parents("#privateMessages").length>0){$("#postform").remove();return Answers.Util.ReloadPage(window.location.href.split("#")[0]+"#"+msgId)}if(container.length>0){if(!container.attr("msgParentId")){if(refreshall===true)dorefreshall=true;ajaxoptions.url=Answers.Res.ThreadSummaryUrl;selector="#ThreadSummary";container=$(selector)}}else container=$('.unrenderedmessage[msgId="'+msgId+'"]');if(container.length===0)return false;ajaxoptions.success=[function(result){var newcontainer,postform;postform=container.find("#postform");if(postform.length){Answers.Thread.HideReply();postform.appendTo("#PageContent")}container.replaceWith(result);newcontainer=$(selector);newcontainer.each(function(i){Answers.Thread.SetEventHandler(newcontainer[i]);Answers.DropNav.StartNav(newcontainer[i])});Answers.Thread.ShowFilesUploaded(msgId);if(dorefreshall===true)Answers.Thread.RefreshAllMessages(true);Answers.ProfileImage.RefreshProfileImage()}];ajaxoptions.complete=[callback,function(){if(Answers.Thread.DoSetZIndex)Answers.Thread.SetZIndex()}];ajaxoptions.statusCode={404:function(){Answers.Util.ReloadPage()},500:function(result){$(".msgContent",container).html(result.responseText);$(".ratingYBtn, .msgHistoryBtn",container).addClass("disabled")}};$.ajax(ajaxoptions);return false},Subscribe:function(button,threadId,subscribe){button.addClass("disabled");$.post(Answers.Res.SubscribeUrl,{threadId:threadId,subscribe:subscribe,antiForgeryKey:$("#_AntiForgeryKey").val()},function(result){button.removeClass("disabled");if(result.IsError){if(result.Result.length>0)Answers.Util.ShowSimpleDialog(result.Result,result.ErrorMessage)}else Answers.Thread.RefreshMsgContent($("#questioncontainer").attr("msgid"))},"json")},ViewHistory:function(msgHistLink,msgId,event){var link=$(msgHistLink).parent();if(link.find(".msgHistory").length===0&&link.data("loading")!==true){link.data("loading",true);$.ajax(Answers.Res.MsgHistoryUrl,{cache:false,data:{messageId:msgId},error:function(jqXHR){if(jqXHR.status===404){link.find(".msgHistoryBtn").addClass("disabled");return Answers.Util.ShowSimpleDialog("",$(jqXHR.responseText).html())}Answers.Util.ReloadPage()},success:function(result){link.children().eq(-1).children().eq(0).append(result);link.children().eq(0).trigger("dropNavDelayedShow");link.data("loading",false)}})}},ViewAbuseMenu:function(button,event,byMsgId,abuseTypeId){if(byMsgId){var msgDiv=$('div[msgId="'+byMsgId+'"]').first();if(msgDiv)button=msgDiv.find(".msgAbuseBtn").first()}var msgId,menu,parent;if(button.length>0){parent=button.parent();menu=parent.find(".msgAbuseShow");if(menu.length===0&&button.data("loading")!==true){button.data("loading",true);msgId=button.closest("div[msgId]").attr("msgId");$.get(Answers.Res.Abuse.MsgAbuseMenuUrl,{messageId:msgId,tm:(new Date).getTime()},function(output){parent.append(output);button.trigger("dropNavDelayedShow");button.data("loading",false);if(!Answers.Abuse)$.ajax({url:Answers.Res.Abuse.AbuseScriptUrl,dataType:"script",complete:function(){Answers.Abuse.ReportAbuseActions(parent,abuseTypeId)},cache:true});else Answers.Abuse.ReportAbuseActions(parent,abuseTypeId)})}}},DeleteFileloaded:function(){var fileloaded=$(this).closest(".fileitem"),downloadlink=fileloaded.find(".fileattached").attr("href"),downloadhost=/[\/\/](\S+)\?/g,deletelink=downloadlink.replace(downloadhost,"//"+Answers.Res.DeleteFileUrl+"?")+"&cb=?";$.getJSON(deletelink,function(data){if(data.Code==0){fileloaded.remove();var numfilesloaded=$(".fileitem").length;if(numfilesloaded<5){$(".replyUploadBtn",parent.document).show();if(numfilesloaded==0)$("#fileuploaded .fileAttachmentIcon").remove()}}else{var errMsg=Answers.Res.ViewThread.FudErrorDeletingFile;$("#fuderror",parent.document).text(errMsg).show()}})},UpdateFileUploaded:function(uploadSessionId,furl,fnm){$(".replyUploadBtn").removeClass("disabled");Answers.Thread.EnableMessageSubmit($(document));$("#uploadprogress").hide();$("#fuderror").text("");var filelink=$("<a/>").attr("href",furl).addClass("fileattached").text(fnm),deletelink=$('<span>(<input type="image" src="/static/images/errorclose.png" class="deletefile" />);&nbsp;</span>').css("white-space","nowrap").one("click",Answers.Thread.DeleteFileloaded),fileitem=$('<span class="fileitem"></span>').css("display","inline-block");$("#fileuploaded").append(fileitem.append(filelink).append(deletelink)).show();var numfilesloaded=$(".fileitem").length;if(numfilesloaded==1)$("#fileuploaded").prepend($('<span class="fileAttachmentIcon sprite icon_attachFile"></span>'));if(numfilesloaded>=5)$(".replyUploadBtn").hide();if($("#uploadFileSessionId").val()=="")$("#uploadFileSessionId").val(uploadSessionId)},ShowFilesUploaded:function(msgId){var target;if(msgId)target="div[msgId='"+msgId+"'] div[infoSvcUrl]";else target="div[infoSvcUrl]";$(target).each(function(index,e){var element=$(e),infoSvcUrl=element.attr("infoSvcUrl");if(!element.get(0)||!infoSvcUrl)return;$.getJSON(infoSvcUrl,function(data){if(data.Code!=0)return;var files=data.Files;if(!files||files.length==0)return;element.append($('<span class="fileAttachmentIcon sprite icon_attachFile"></span>'));for(var i=0;i<files.length;i++){var filelink=$("<a/>").attr("href",document.location.protocol+"//"+files[i].furl).addClass("fileattached").text(files[i].fnm);element.append(filelink);if(files.length!=1&&i<files.length-1)element.append("&nbsp; | &nbsp;")}})})},UpdateFileUploadFailed:function(errMsg){Answers.Thread.EnableMessageSubmit($(document));$(".replyUploadBtn").removeClass("disabled");$("#uploadprogress").hide();$("#fuderror").text(errMsg)},SubmitUpload:function(container){$("#uploadprogress",container).show();this.DisableMessageSubmit(container);setTimeout(Answers.Thread.StopUpload,Answers.Res.ViewThread.FudServiceTimeout);$("#ImageUploadFrm").submit();$("#uploadFileFrame",container).addClass("hidden")},DisableMessageSubmit:function(container){if(!$("#replySubmitBtn",container).hasClass("disabled"))$("#replySubmitBtn",container).addClass("disabled");if(!$("#replyCancelBtn",container).hasClass("disabled"))$("#replyCancelBtn",container).addClass("disabled")},EnableMessageSubmit:function(container){if($("#replySubmitBtn",container).hasClass("disabled"))$("#replySubmitBtn",container).removeClass("disabled");if($("#replyCancelBtn",container).hasClass("disabled"))$("#replyCancelBtn",container).removeClass("disabled")},StopUpload:function(){Answers.Thread.EnableMessageSubmit(parent.document);$("#uploadprogress",parent.document).hide();$("#fuderror",parent.document).text(Answers.Res.ViewThread.FileUploadTimeoutMsg);$(".replyUploadBtn",parent.document).removeClass("disabled")},SubscribeThreadAfterSignIn:function(threadId){var button=$("#subscribeThreadBtn"),subscribeFn=function(emailReady){if(!emailReady)return;Answers.Util.SetEventLogging(1);Answers.Thread.Subscribe(button,$("#varThreadId").val(),true)};Answers.Auth.VerifyEmail(subscribeFn)},SetEventHandler:function(container){if(container)Answers.Thread.UnsetEventHandlers(container);$("img:not([alt])").attr("alt",Answers.Res.Common.DefaultAltText);$(".messageControls button",container).on("mousedown.threadactions, keydown.threadactions",function(event){var that=this;Answers.Util.HandleActionsForDropdown(event,function(){$(".contentWrapper").css("z-index",1);$(that).parents(".contentWrapper").css("z-index",2)})});$(".thdJoinBtn",container).on("click.threadactions",function(){if($(this).hasClass("disabled"))return;Answers.Thread.Join($("#varThreadId").val())});$(".thdRecommendBtn",container).on("click.threadactions",function(){if($(this).hasClass("disabled"))return;Answers.Thread.Recommend($("#varThreadId").val())});$("#subscribeThreadBtn",container).on("click.threadactions",function(){var button=$(this);if(button.hasClass("disabled"))return;Answers.Auth.SignInThen("SubscribeThread",$("#varThreadId").val())});$("#unsubscribeThreadBtn",container).on("click.threadactions",function(){var button=$(this);if(button.hasClass("disabled"))return;Answers.Util.SetEventLogging(2);Answers.Thread.Subscribe(button,$("#varThreadId").val(),false)});$(".thdEditBtn",container).on("click.threadactions",function(event){if($(this).hasClass("disabled"))return;Answers.Thread.Edit("EditThreadByOwner",null,null,event.target)});$(".replyMeta",container).on("click.threadactions",function(){var msgDiv=$(this).closest("div[msgId]"),msgContainer=msgDiv.find(".replyToMsg");if(msgContainer.is(":visible")){msgContainer.hide();return}if($.trim(msgContainer.text())!=""){msgContainer.show();return}var parentMsgId=msgDiv.attr("msgParentId");Answers.Thread.ShowReplyTo(msgDiv.attr("msgId"),parentMsgId,msgContainer)});$(".ratingYBtn",container).on("click.threadactions",function(){if($(this).hasClass("disabled")||$(this).hasClass("active"))return;Answers.Util.SetEventLogging(6);var msgId=$(this).closest("div[msgId]").attr("msgId");Answers.Thread.Vote(msgId)});$(".markAnsBtn, .unmarkAnsBtn",container).on("click.threadactions",function(){if($(this).hasClass("disabled"))return;Answers.Thread.MarkAnswer($(this).closest("div[msgId]").attr("msgId"),$(this).hasClass("markAnsBtn"))});$(".msgReplyBtn",container).on("click.threadactions",function(){if($(this).hasClass("disabled"))return;var messageDiv=$(this).closest("div[msgId]");if(messageDiv&&messageDiv[0].id==="questioncontainer")Answers.Util.SetEventLogging(4);else Answers.Util.SetEventLogging(5);var msgId=messageDiv.attr("msgId");Answers.Thread.Reply(msgId,false)});$(".msgReplyQtBtn",container).on("click.threadactions",function(){if($(this).hasClass("disabled"))return;var messageDiv=$(this).closest("div[msgId]");if(messageDiv&&messageDiv[0].id==="questioncontainer")Answers.Util.SetEventLogging(4);else Answers.Util.SetEventLogging(5);var msgId=messageDiv.attr("msgId");Answers.Thread.Reply(msgId,true)});$(".msgEditBtn",container).on("click.threadactions",function(){if($(this).hasClass("disabled"))return;$("#actReason").val("");var msgId=$(this).closest("div[msgId]").attr("msgId");Answers.Thread.EditReply($(this),msgId,"3")});$(container).on("click.threadactions","#replySubmitBtn",function(){if($(this).hasClass("disabled"))return;Answers.Thread.PostReply()});$(container).on("click.threadactions","#replyCancelBtn",function(){if($(this).hasClass("disabled"))return;$("#Escalate1On1Panel").hide();var msg=Answers.Editor.Content("replyEditor");if(msg.length>0)if(!window.confirm(Answers.Res.ViewThread.WarningCancel))return;$("#replySubmitBtn").removeClass("disabled");Answers.Thread.HideReply()});$(container).on("click.threadactions","#replyDeleteBtn",function(){if($(this).hasClass("disabled"))return;if(!window.confirm(Answers.Res.ViewThread.DelPostWarning))return;var msgId=$(this).closest("div[msgId]").attr("msgId");Answers.Thread.DeleteReply(msgId)});$(".msgHistoryBtn",container).on("mouseup.threadactions, keydown.threadactions",function(event){var that=this;if($(that).hasClass("disabled"))return;Answers.Util.HandleActionsForDropdown(event,function(){var msgDiv=$(that).closest("div[msgId]");Answers.Thread.ViewHistory(that,msgDiv.attr("msgId"),event)})});$(".msgAbuseBtn",container).on("mouseup.threadactions, keydown.threadactions",function(event){var that=this;if($(that).hasClass("disabled"))return;Answers.Util.HandleActionsForDropdown(event,function(){Answers.Thread.ViewAbuseMenu($(that),event)})});$(container).on("click.threadactions","#abuseEditAck",function(){$("#replySubmitBtn",container).toggleClass("disabled",!$("#abuseEditAck",container).attr("checked"))});if(Answers.Thread.SetModeratorEventHandler)Answers.Thread.SetModeratorEventHandler(container)},PMEventHandler:function(){$(".privateTitle").on("click.threadactions",function(event){$(this).parent().find(".privateMessageSource").toggle()})},UnsetEventHandlers:function(container){var eventselector=[".messageControls button",".thdJoinBtn",".thdRecommendBtn","#subscribeThreadBtn","#unsubscribeThreadBtn",".thdEditBtn",".replyMeta",".ratingYBtn",".markAnsBtn",".unmarkAnsBtn",".msgReplyBtn",".msgReplyQtBtn",".msgEditBtn","#replySubmitBtn","#replyCancelBtn","#replyDeleteBtn",".msgHistoryBtn",".abuseReport",".msgAbuseBtn"];$(container).off(".threadactions");$(eventselector.join(","),container).off(".threadactions")},DoSetZIndex:$.browser.msie&&parseInt($.browser.version,10)<8,SetZIndex:function(){if(Answers.Thread.DoSetZIndex){var containers=[".contentWrapper",".TopDiv",".tabs","#ThreadSummary","#allReplies","#ThreadContent","#SideBar","#PageContent","#TopNav"].join(",");$($(containers).get().reverse()).each(function(index,value){$(value).css("z-index",++index)});var messageItems=[".message",".userInfo",".ratingPanel",".popupNav"].reverse();$(messageItems).each(function(index,value){$(value).css("z-index",++index)})}},ShowMoreHelp:function(){$.each($("ul.moreHelpBox",$("#MoreHelpPanel")),function(index,moreHelpLink){$.ajax(Answers.Res.ViewThread.MoreHelpUrl,{timeout:Answers.Res.Common.RelatedContentLoadTimeout*1000,data:{threadId:$("#varThreadId").val()},success:function(response){$(moreHelpLink).replaceWith($(response).on("click","a",function(event){Answers.Util.SetEventLogging(16)}))},complete:function(request,status){if(status!=="success")$(".indicator",$(moreHelpLink)).html(Answers.Res.Common.NoRelatedContentFailureMsg).removeClass("indicator").addClass("moreHelpLink wrapWord")},dataType:"html"})})},CreateWaitIndicator:function(){var delayTime=Answers.Res.AjaxIndicatorDelayTime||1000;$(document).ajaxStart(function(event){$(".lightBox").fadeOut().remove()});$(document).ajaxSend(function(event,jqXHR,ajaxOptions){var container,msgId;if(ajaxOptions.waitdata.threadId&&!ajaxOptions.waitdata.messageId)container=$("#ThreadSummary");else if(ajaxOptions.waitdata.messageId){msgId=ajaxOptions.waitdata.messageId;if(ajaxOptions.waitdata.replymessage)msgId=ajaxOptions.waitdata.replymessage;container=$('div[msgId="'+msgId+'"]');if(container.attr("id")=="questioncontainer")container=$("#ThreadSummary")}if(container&&container.length){ajaxOptions.currentMessage=container;var sendcount=parseInt(container.attr("data-sendcount"),10)||0;container.attr("data-sendcount",++sendcount);if($(".lightBox",container).length===0){container.prepend($('<div class="lightBox"></div>').hide());$(".lightBox",container).hide().delay(delayTime).fadeIn()}}});var decrementCount=function(ajaxOptions){if(ajaxOptions.currentMessage&&ajaxOptions.currentMessage.length)if(ajaxOptions.currentMessage.attr("data-sendcount"))ajaxOptions.currentMessage.attr("data-sendcount",parseInt(ajaxOptions.currentMessage.attr("data-sendcount"),10)-1)};$(document).ajaxSuccess(function(event,jqXHR,ajaxOptions){decrementCount(ajaxOptions)});$(document).ajaxError(function(event,jqXHR,ajaxOptions){decrementCount(ajaxOptions)});$(document).ajaxComplete(function(event,jqXHR,ajaxOptions){if(ajaxOptions.currentMessage&&ajaxOptions.currentMessage.length)if(!ajaxOptions.currentMessage.attr("data-sendcount")||ajaxOptions.currentMessage.attr("data-sendcount")==0)$(".lightBox",ajaxOptions.currentMessage).fadeOut().remove()});$(document).ajaxStop(function(event){$(".lightBox").fadeOut().remove()});$.ajaxPrefilter(function(options,originalOptions,jqXHR){options.waitdata=originalOptions.data||{}})},hoverStartDate:new Date(9999,12,31),SuspendOnUnloadMsg:false,onBeforeUnload:function(){if(!Answers.Thread.SuspendOnUnloadMsg&&$("#replyEditor").length>0){var msg=Answers.Editor.Content("replyEditor");if(msg&&msg.length>0)return ""}}};$(document).ready(function(){Answers.Thread.ThreadType=$("#varThreadType").val();$("div[msgId]").each(function(i,v){Answers.Thread.SetEventHandler($(v))});if($("#privateMessages").length>0)Answers.Thread.PMEventHandler();window.onbeforeunload=Answers.Thread.onBeforeUnload;var reasonTextArea=$("#escalationReason");reasonTextArea.attr("maxlength",Answers.Res.ViewThread.EscalationMaxReasonLength.toString());reasonTextArea.focus(function(){$("#removeEscalationErr").hide()});$("#escalationReason_remains").attr("format",Answers.Res.ViewThread.CharRemain);reasonTextArea.SetInputTextLength();$("#dontWarnOnPublicReplyWithPrivate").click(function(){Answers.Util.SetCookie("dontWarnOnPublicReplyWithPrivate",$(this).is(":checked"),null,true)});$("#privateWarningOK").click(function(){Answers.Util.HideDialog($("#replyToMessageWithPrivateWarning"))});$(".Escalate1On1Button").click(function(){$("#postform").hide()});$(".icon_rssbig").one("click",function(){Answers.Util.SetEventLogging(9)});$(".icon_twitter").one("click",function(){Answers.Util.SetEventLogging(10)});$(".icon_facebook").one("click",function(){Answers.Util.SetEventLogging(11)});$("#pagerTop #goToPageNum").on({"input.viewthread":function(e){$(this).blur().focus()},"keyup.viewthread":function(e){if(e.which!==13)Answers.Util.ValidatePageOnlyNumbers(this,"#pagerTop")},"keypress.viewthread":function(e){if(e.which===13){Answers.Util.ValidatePageOnlyNumbers(this,"#pagerTop");var newPage=Answers.Util.ValidatePageValue(e,this.value,$("#currentPage").val(),$("#currentMaxPage").val(),"#pagerTop");if(newPage>0){Answers.Util.SetEventLogging(12);Answers.Util.ReloadPage($("#goToPageLink").attr("href").replace("~pagenum~",newPage))}return false}}});$("#pagerBottom #goToPageNum").on({"input.viewthread":function(e){$(this).blur().focus()},"keyup.viewthread":function(e){if(e.which!==13)Answers.Util.ValidatePageOnlyNumbers(this,"#pagerBottom")},"keypress.viewthread":function(e){if(e.which===13){Answers.Util.ValidatePageOnlyNumbers(this,"#pagerBottom");var newPage=Answers.Util.ValidatePageValue(e,this.value,$("#currentPage").val(),$("#currentMaxPage").val(),"#pagerBottom");if(newPage>0){Answers.Util.SetEventLogging(12);Answers.Util.ReloadPage($("#goToPageLink").attr("href").replace("~pagenum~",newPage))}return false}}});$("#TopNav a").one("click.viewthread",function(){Answers.Util.SetEventLogging(13)});$("img").hover(function(){Answers.Thread.hoverStartDate=new Date},function(){var diff=(new Date).getTime()-Answers.Thread.hoverStartDate.getTime();if(diff>Answers.Res.LtsLogging.ImgHoverTime){Answers.Util.SetEventLogging(17);$("img").unbind("hover")}});$("#prevPage, #nextPage").one("click",function(){Answers.Util.SetEventLogging(14)});$("#SearchForm").on("submit.viewthread",function(){if($.trim($("#SearchTerm").val()).length>0)Answers.Util.SetEventLogging(!$(this).is(".isaskingquestion")?7:8)});var msgId=Answers.Util.QueryString("msgId");if(msgId&&$("div[msgId='"+msgId+"']").length>0){var offset=$("div[msgId='"+msgId+"']").offset();window.scrollTo(0,offset.top)}Answers.Thread.ShowFilesUploaded();Answers.Thread.ShowMoreHelp();Answers.Thread.CreateWaitIndicator();Answers.Thread.SetZIndex()})